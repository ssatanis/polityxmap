# Disable MultiViews to avoid ambiguous matches
Options -MultiViews

RewriteEngine On

# Handle React Router paths for admin section
RewriteRule ^admin$ admin-react.html [L]
RewriteRule ^admin/(.*)$ admin-react.html [L]
RewriteRule ^login$ login-react.html [L]
RewriteRule ^auth/login$ login-react.html [L]

# If request is for a real file or directory, serve it
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# Otherwise, if adding .html makes it a valid file, rewrite internally
RewriteCond %{DOCUMENT_ROOT}/$1.html -f
RewriteRule ^([^/]+)/?$ /$1.html [L]

# Specific rule for homepage
RewriteRule ^$ index.html [L]

# Custom 404 error page
ErrorDocument 404 /404.html

# Set security headers
<IfModule mod_headers.c>
  Header set X-Content-Type-Options "nosniff"
  Header set X-XSS-Protection "1; mode=block"
  Header set X-Frame-Options "SAMEORIGIN"
  Header set Referrer-Policy "strict-origin-when-cross-origin"
  Header set Content-Security-Policy "default-src 'self' https://cdn.prod.website-files.com https://fonts.googleapis.com https://fonts.gstatic.com https://ajax.googleapis.com https://d3e54v103j8qbb.cloudfront.net https://cdnjs.cloudflare.com https://unpkg.com 'unsafe-inline' 'unsafe-eval';"
</IfModule>

# Prevent directory listing
Options -Indexes

# Protect sensitive files
<FilesMatch "^(\.env|\.git|\.htpasswd|config\.php)">
  Order Allow,Deny
  Deny from all
</FilesMatch>